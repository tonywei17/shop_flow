# Dev Log â€” 2025-12-16

## Summary
- Protected all product-related routes (list, details, cart, checkout, account) behind login for the storefront.
- Simplified homepage to static promo sections; removed featured products and listing to keep unauthenticated users from seeing product data.
- Cleaned header by removing duplicate search bar; theme toggle now works with next-themes provider.
- Verified unauthenticated access to /products redirects to /login with redirect param; homepage shows only static content.
- Integrated product images end-to-end: API now returns primary_image_url and full images array; storefront list/detail render images; Supabase host whitelisted in next.config.
- Fixed Next.js 15 params async issue on admin commerce detail page; ensured admin/product images use correct Supabase env vars.
- Standardized .env.local across apps and restarted dev servers on ports 3000/3001/3002.

## Changes
- `apps/storefront/src/middleware.ts`: added `/products` to protected routes.
- `apps/storefront/src/app/page.tsx`: converted to static promo + CTA, no product listing; CTA adjusts based on login state.
- `apps/storefront/src/app/layout.tsx`, `apps/storefront/src/components/theme-provider.tsx`: ensured next-themes provider wraps app for working light/dark toggle.
- `apps/storefront/src/components/layout/header.tsx`: removed header search bar and kept actions on the right.
- `packages/db/src/products.ts`: join `product_images`, compute `primary_image_url`, expose `images` array for list/detail.
- `apps/storefront/src/app/products/page.tsx`: render primary image in grid cards with proper sizing.
- `apps/storefront/src/app/products/[id]/page.tsx`: render main image + thumbnail gallery; uses `primary_image_url` and `images`.
- `apps/storefront/next.config.ts`: allow `supabase-api.nexus-tech.cloud` for next/image.
- `apps/web/src/app/(dashboard)/commerce/[id]/page.tsx`: await async params (Next.js 15+).
- `.env.local` (root/apps/*): unified Supabase/MEDUSA/admin credentials; restarted dev servers on 3000/3001/3002.

## Verification
- Manual: 
  - Home (unauth): shows static hero/features/about/CTA, no product grid.
  - /products (unauth): redirects to `/login?redirect=%2Fproducts` (confirmed via browser snapshot).
  - Storefront /products: product cards now show Supabase images with correct sizing/background containment.
  - Storefront /products/[id]: main image renders, thumbnails show when multiple images exist.
  - Admin product image upload: bucket + policies created; upload, set primary, reorder, alt edit, delete all OK; avatar upload fixed.

## Next Steps
- Run full lint/test suite for the monorepo if time permits; currently focused on storefront.
- After credentials confirmation, commit and push these changes to GitHub.
